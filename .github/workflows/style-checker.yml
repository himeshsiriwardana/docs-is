name: Vale Lint (Markdown Only)

on:
    pull_request:
      paths:
        - '**.md'

jobs:
    vale:
        name: Vale style check
        runs-on: ubuntu-latest
    
        steps:
            - name: Check out code
              uses: actions/checkout@v4
              with:   
                  fetch-depth: 0

            - name: Set up Python
              uses: actions/setup-python@v4
            
            - name: Install Vale
              run: |
                pip install vale
            
            - name: Install Reviewdog
              run: |
                    curl -sfL https://raw.githubusercontent.com/reviewdog/reviewdog/master/install.sh | sh -s -- -b /usr/local/bin

            - name: Get changed Markdown files
              id: changed_files
              run: |
                    git fetch origin ${{ github.base_ref }}
                    FILES=$(git diff --name-only origin/${{ github.base_ref }}...HEAD | grep '\.md$' || true)
                    echo "Changed Markdown files:"
                    echo "$FILES"
                    echo "$FILES" > changed_files.txt
    
            - name: Run Vale and post reviewdog comments
              if: always()
              run: |
                if [ -s changed_files.txt ]; then
                    vale --config=en/.vale.ini $(cat changed_files.txt) --output=JSON | \
                    reviewdog -f=rdjson -name="Vale" -reporter=github-pr-review -fail-on-error=false -filter-mode=file
                else
                    echo "No Markdown files to lint."
                fi
              env:
                REVIEWDOG_GITHUB_API_TOKEN: ${{ secrets.GITHUB_TOKEN }}
                  
            


                

